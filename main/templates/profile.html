{% extends "base.html" %}
{% set active_page = "settings" %}

{% block js_imports %}
	<script src="/static/js/sha256.js"></script>
	<script>
	$(document).ready(function() {
		$("[name=profile]").submit(function() {
			if ($("#profileform_password").val() != "") {
				$("[name=profile] #pwd_secret").val(Sha256.hash($("#profileform_password").val()));
			}
			if ($("#profileform_password_repeat").val() != "") {
				$("[name=profile] #pwd2_secret").val(Sha256.hash($("#profileform_password_repeat").val()));
			}
			if ($("#old_password").val() != "") {
				$("[name=profile] #old_pwd_secret").val(Sha256.hash($("#old_password").val()));
			}
		});
	});
	</script>
{% endblock %}
{% block content %}
	<div class="row">
		<div class="col-md-12" id="registration">
			<div class="page-header">
				<h1>Your Profile</h1>
			</div>
			<form role="form" action="{{ url_for('profile') }}" method="post" name="profile">
			{{ profileform.hidden_tag() }}
				<div class="form-group">
					{{ profileform.email.label(class="control-label col-sm-4") }}
					<div class="col-sm-8">
						{{ profileform.email(class="form-control") }}
						<span class="help-block">
							{% if profileform.email.errors %}{% for error in profileform.email.errors %}{{error}}{% endfor %}{% endif %}
						</span>
					</div>
				</div>
				<div class="form-group">
					{{ profileform.name.label(class="control-label col-sm-4") }}
					<div class="col-sm-8">
						{{ profileform.name(class="form-control") }}
						<span class="help-block">
							{% if profileform.name.errors %}{% for error in profileform.name.errors %}{{error}}{% endfor %}{% endif %}
						</span>
					</div>
				</div>
				<div class="form-group">
					<label class="control-label col-sm-4" for="profileform_password">Change password</label>
					<div class="col-sm-8">
						<input class="form-control" id="profileform_password" name="profileform_password" type="password">
						<span class="help-block">
							{% if profileform.pwd_hash.errors %}{% for error in profileform.pwd_hash.errors %}{{error}}{% endfor %}{% endif %}
						</span>
					</div>
				</div>
				<div class="form-group">
					<label class="control-label col-sm-4" for="profileform_password_repeat">Confirm password:</label>
					<div class="col-sm-8">
						<input class="form-control" id="profileform_password_repeat" name="profileform_password_repeat" type="password">
						<span class="help-block">
							{% if profileform.pwd2_hash.errors %}{% for error in profileform.pwd2_hash.errors %}{{error}}{% endfor %}{% endif %}
						</span>
					</div>
				</div>
				<div class="form-group">
					<div class="col-sm-4"></div>
					<div class="col-sm-4">
						<input class="form-control" id="old_password" name="old_password" type="password" placeholder="Old Password">
						<span class="help-block">
							{% if profileform.old_pwd_hash.errors %}{% for error in profileform.old_pwd_hash.errors %}{{error}}{% endfor %}{% endif %}
						</span>
					</div>
					<div class="col-sm-4">
						<input class="btn btn-primary" id="profileform_submit" type="submit" value="Submit Changes">
					</div>
				</div>
			</form>
		</div>
	</div>
{% endblock %}
